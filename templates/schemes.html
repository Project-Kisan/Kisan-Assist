<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Government Schemes - Project Kisan</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Feather Icons -->
    <script src="https://unpkg.com/feather-icons"></script>
    <!-- Custom CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <div class="container-fluid p-0">
        <!-- Header -->
        <header class="kisan-header">
            <div class="container">
                <div class="row align-items-center py-3">
                    <div class="col-2">
                        <button class="btn-back" onclick="window.location.href='{{ url_for('index') }}'">
                            <i data-feather="arrow-left"></i>
                        </button>
                    </div>
                    <div class="col-10 text-center">
                        <h2 class="page-title">Government Schemes</h2>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="container mt-4">
            <!-- Search and Filter -->
            <div class="section-card mb-4">
                <div class="row g-3">
                    <div class="col-8">
                        <input type="text" class="form-control" id="schemeSearch" 
                               placeholder="Search schemes..." onkeyup="filterSchemes()">
                    </div>
                    <div class="col-4">
                        <select class="form-select" id="schemeType" onchange="filterSchemes()">
                            <option value="all">All Types</option>
                            <option value="income_support">Income Support</option>
                            <option value="insurance">Insurance</option>
                            <option value="advisory">Advisory</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Schemes List -->
            <div id="schemesList">
                <div class="scheme-loading">Loading government schemes...</div>
            </div>

            <!-- Quick Actions -->
            <div class="section-card mb-4">
                <h3 class="section-title">Quick Actions</h3>
                <div class="quick-actions">
                    <button class="action-btn" onclick="checkEligibility()">
                        <i data-feather="check-circle"></i>
                        Check Eligibility
                    </button>
                    <button class="action-btn" onclick="downloadForm()">
                        <i data-feather="download"></i>
                        Download Forms
                    </button>
                    <button class="action-btn" onclick="trackApplication()">
                        <i data-feather="search"></i>
                        Track Application
                    </button>
                    <button class="action-btn" onclick="getHelp()">
                        <i data-feather="help-circle"></i>
                        Get Help
                    </button>
                </div>
            </div>

            <!-- Important Notice -->
            <div class="section-card mb-4">
                <div class="alert alert-info">
                    <i data-feather="info"></i>
                    <strong>Important:</strong> Always verify scheme details from official government websites 
                    before applying. This app provides general information only.
                </div>
            </div>
        </main>

        <!-- Bottom Navigation -->
        <nav class="bottom-nav">
            <div class="nav-item" onclick="window.location.href='{{ url_for('index') }}'">
                <i data-feather="home"></i>
            </div>
            <div class="nav-item" onclick="window.location.href='{{ url_for('market_prices') }}'">
                <i data-feather="bar-chart-2"></i>
            </div>
            <div class="nav-item" onclick="window.location.href='{{ url_for('voice_query') }}'">
                <i data-feather="message-circle"></i>
            </div>
            <div class="nav-item active">
                <i data-feather="user"></i>
            </div>
        </nav>
    </div>

    <!-- Scheme Detail Modal -->
    <div class="modal fade" id="schemeModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="modalTitle"></h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" id="modalBody">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-kisan" onclick="openOfficialSite()">
                        Visit Official Site
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Custom JS -->
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
    
    <script>
        // Initialize Feather Icons
        feather.replace();
        
        let allSchemes = [];
        let schemeModal;
        
        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            schemeModal = new bootstrap.Modal(document.getElementById('schemeModal'));
            loadSchemes();
        });
        
        function loadSchemes() {
            fetch('/api/get_scheme')
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'success') {
                        allSchemes = data.schemes;
                        displaySchemes(allSchemes);
                    } else {
                        document.getElementById('schemesList').innerHTML = 
                            '<div class="alert alert-danger">Unable to load schemes</div>';
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    document.getElementById('schemesList').innerHTML = 
                        '<div class="alert alert-danger">Error loading schemes</div>';
                });
        }
        
        function displaySchemes(schemes) {
            const schemesList = document.getElementById('schemesList');
            
            if (schemes.length === 0) {
                schemesList.innerHTML = '<div class="alert alert-info">No schemes found matching your criteria</div>';
                return;
            }
            
            let html = '';
            schemes.forEach(scheme => {
                html += `
                    <div class="scheme-card mb-3" onclick="showSchemeDetails(${scheme.id})">
                        <div class="scheme-header">
                            <h4>${scheme.name}</h4>
                            <span class="scheme-type">${scheme.type.replace('_', ' ').toUpperCase()}</span>
                        </div>
                        <p class="scheme-description">${scheme.description}</p>
                        <div class="scheme-benefit">
                            <i data-feather="gift"></i>
                            <strong>Benefit:</strong> ${scheme.benefit}
                        </div>
                        <div class="scheme-eligibility">
                            <i data-feather="users"></i>
                            <strong>Eligibility:</strong> ${scheme.eligibility}
                        </div>
                        <div class="scheme-actions">
                            <button class="btn btn-outline-success btn-sm" onclick="event.stopPropagation(); shareScheme('${scheme.name}')">
                                <i data-feather="share-2"></i> Share
                            </button>
                            <button class="btn btn-kisan btn-sm">
                                <i data-feather="arrow-right"></i> Learn More
                            </button>
                        </div>
                    </div>
                `;
            });
            
            schemesList.innerHTML = html;
            feather.replace();
        }
        
        function filterSchemes() {
            const searchTerm = document.getElementById('schemeSearch').value.toLowerCase();
            const schemeType = document.getElementById('schemeType').value;
            
            let filteredSchemes = allSchemes;
            
            // Filter by type
            if (schemeType !== 'all') {
                filteredSchemes = filteredSchemes.filter(scheme => scheme.type === schemeType);
            }
            
            // Filter by search term
            if (searchTerm) {
                filteredSchemes = filteredSchemes.filter(scheme => 
                    scheme.name.toLowerCase().includes(searchTerm) ||
                    scheme.description.toLowerCase().includes(searchTerm) ||
                    scheme.benefit.toLowerCase().includes(searchTerm)
                );
            }
            
            displaySchemes(filteredSchemes);
        }
        
        function showSchemeDetails(schemeId) {
            const scheme = allSchemes.find(s => s.id === schemeId);
            if (!scheme) return;
            
            document.getElementById('modalTitle').textContent = scheme.name;
            document.getElementById('modalBody').innerHTML = `
                <div class="scheme-details">
                    <div class="detail-section">
                        <h6><i data-feather="info"></i> Description</h6>
                        <p>${scheme.description}</p>
                    </div>
                    
                    <div class="detail-section">
                        <h6><i data-feather="gift"></i> Benefits</h6>
                        <p>${scheme.benefit}</p>
                    </div>
                    
                    <div class="detail-section">
                        <h6><i data-feather="users"></i> Eligibility</h6>
                        <p>${scheme.eligibility}</p>
                    </div>
                    
                    <div class="detail-section">
                        <h6><i data-feather="clipboard"></i> How to Apply</h6>
                        <p>${scheme.how_to_apply}</p>
                    </div>
                    
                    <div class="detail-section">
                        <h6><i data-feather="tag"></i> Scheme Type</h6>
                        <span class="badge bg-success">${scheme.type.replace('_', ' ').toUpperCase()}</span>
                    </div>
                </div>
            `;
            
            feather.replace();
            schemeModal.show();
        }
        
        function shareScheme(schemeName) {
            const text = `Check out this government scheme: ${schemeName}. Learn more on Project Kisan app.`;
            
            if (navigator.share) {
                navigator.share({
                    title: 'Government Scheme',
                    text: text,
                    url: window.location.href
                });
            } else {
                navigator.clipboard.writeText(text);
                alert('Scheme information copied to clipboard!');
            }
        }
        
        function checkEligibility() {
            alert('Eligibility checker coming soon! Please consult with local agriculture department for detailed eligibility criteria.');
        }
        
        function downloadForm() {
            alert('Form download feature coming soon! Visit official government websites for application forms.');
        }
        
        function trackApplication() {
            alert('Application tracking coming soon! Use official government portals to track your application status.');
        }
        
        function getHelp() {
            window.location.href = "{{ url_for('voice_query') }}";
        }
        
        function openOfficialSite() {
            alert('Please visit official government websites like pmkisan.gov.in, agricoop.nic.in for more information.');
        }
    </script>
</body>
</html>
